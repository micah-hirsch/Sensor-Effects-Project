---
title: "Sensor Effects: Tables"
output: html_notebook
---


# Packages

```{r}
library(tidyverse)
library(gt)
library(tidystats)
library(gtsummary)

alpha_level <- .05/8 # 8 models, correcting the alpha using Bonferroni method
```


# Table S1 - Speaker Demographics (PD)
```{r}

fileInventories <- rio::import("https://raw.githubusercontent.com/AustinRThompson/multidomain-vowelArtic-PD/main/Data/PreppedData/Speaker%20List_Clean.csv") %>%
  dplyr::select(speaker_id = DatabaseID,
                Group,
                Sex,
                Age,
                dxTime,
                MoCA) %>%
  dplyr::mutate(Group = factor(Group,
                               levels = c("HC", "PD"),
                               labels = c("Control", "PD")),
                Sex = factor(Sex,
                             levels = c("M", "F"),
                             labels = c("Male", "Female")))

listenerRatings <- rio::import(
  file = "https://raw.githubusercontent.com/AustinRThompson/multidomain-vowelArtic-PD/main/Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv"
) %>%
  dplyr::filter(condition == "conv") %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::summarise(Rating_M = mean(Int_M, na.rm = T)) %>%
  dplyr::rename(speaker_id = DatabaseID)

speakers <- rio::import("Data/Cleaned Data/articulation_rate.csv") |>
  dplyr::select(speaker_id,
                Group = group,
                Sex = sex,
                Age = age) |>
  dplyr::distinct() %>%
  base::merge(., fileInventories, all.x = TRUE) %>%
  base::merge(., listenerRatings, all.x = TRUE) %>%
    # Severity-surrogate ratings
  dplyr::mutate(
    Severity = case_when(
      Group == "Control" ~ "",
      Rating_M > 94 ~ "Normal",
      between(Rating_M, 85, 94.99) ~ "Mild",
      between(Rating_M, 70, 84.99) ~ "Moderate",
      between(Rating_M, 45, 69.99) ~ "Severe",
      Rating_M < 45 ~ "Profound",
      TRUE ~ ""
    )
  )

speakers %>%
  arrange(desc(Sex)) %>%
  arrange(desc(Group)) %>%
  dplyr::filter(Group == "PD") |>
  dplyr::rename(DatabaseID = speaker_id) %>%
  group_by(Sex,Group) %>%
  dplyr::mutate(
    StudyID = paste0(ifelse(Group == "PD","PD","C"),ifelse(Sex == "Male","M","F"),str_pad(row_number(), 2, pad = "0")),
    Sex = factor(Sex,
                 levels = c("Male",
                        "Female"),
                 labels = c("Male Speakers",
                            "Female Speakers"))) %>%
  dplyr::select(!c(DatabaseID, MoCA, Rating_M)) %>%
  dplyr::relocate(StudyID, .before = Group) |>
  
  # Creating the gt table
  gt::gt(rowname_col = "StudyID",
         groupname_col = "Sex") %>%
  
  # Title
  gt::tab_header(title = "Table S1",
                 subtitle = "Speaker demographics for speakers with Parkinson's disease.") %>%
  
  # Replace missing values with blanks
  gt::sub_missing(columns = everything(),
                  rows = everything(),
                  missing_text = "") %>%
  
  # Renaming columns
  gt::cols_label(dxTime = "Time Since Diagnosis (years)") %>%
  
  
  # Adding summary rows
  ## Control Speakers
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Group),
    fns = list(n = ~ NROW(.)),
    fmt = list(~ gt::fmt_number(., decimals = 0))
  ) %>% 
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Age, dxTime),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  ## Female Speakers
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Group),
    fns = list(n = ~ NROW(.)),
    fmt = list( ~ gt::fmt_number(., decimals = 0))
  ) %>% 
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Age, dxTime),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  gt::grand_summary_rows(
    columns = c(Group),
    fns = list(
      N = ~ NROW(.)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 0))
  ) |>
  gt::grand_summary_rows(
    columns = c(Age, dxTime),
    fns = list(
      `Total M` = ~ mean(., na.rm = TRUE),
      `Total SD` = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) |>
  
  # Adding footnote to Severity
  gt::tab_footnote(
    footnote = "Severity labels were previously determined in Thompson & Kim (2024) based on the intelligibility measures using the surrogate-severity measures outlined in Stipancic et al. (2022). Specifically, intelligibility values > 94% are `Normal`, 85% - 94% are `Mild`, 70% - 84% are `Moderate`, 45% - 69% are `Severe`, and < 45% are `Profound`.",
    locations = gt::cells_column_labels(columns = Severity)
  ) |>
  gt::tab_options(table.font.names = "Times New Roman") |>

  gt::gtsave(filename = "Tables/Table S1_Speakers with PD Demographics.html")

```

# Table S2 - Speaker Demographics (Control)
```{r}
speakers %>%
  arrange(desc(Sex)) %>%
  arrange(desc(Group)) %>%
  dplyr::filter(Group == "Control") |>
  dplyr::rename(DatabaseID = speaker_id) %>%
  group_by(Sex,Group) %>%
  dplyr::mutate(
    StudyID = paste0(ifelse(Group == "PD","PD","C"),ifelse(Sex == "Male","M","F"),str_pad(row_number(), 2, pad = "0")),
    Sex = factor(Sex,
                 levels = c("Male",
                        "Female"),
                 labels = c("Male Speakers",
                            "Female Speakers"))) %>%
  dplyr::select(!c(DatabaseID, MoCA, dxTime, Rating_M, Severity)) %>%
  dplyr::relocate(StudyID, .before = Group) |>
  
  # Creating the gt table
  gt::gt(rowname_col = "StudyID",
         groupname_col = "Sex") %>%
  
  # Title
  gt::tab_header(title = "Table S2",
                 subtitle = "Speaker demographics for speakers without Parkinson's disease.") %>%
  
  # Replace missing values with blanks
  gt::sub_missing(columns = everything(),
                  rows = everything(),
                  missing_text = "") %>%
  
  # Adding summary rows
  ## Control Speakers
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Group),
    fns = list(n = ~ NROW(.)),
    fmt = list(~ gt::fmt_number(., decimals = 0))
  ) %>% 
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Age),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  ## Female Speakers
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Group),
    fns = list(n = ~ NROW(.)),
    fmt = list( ~ gt::fmt_number(., decimals = 0))
  ) %>% 
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Age),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  gt::grand_summary_rows(
    columns = c(Group),
    fns = list(
      N = ~ NROW(.)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 0))
  ) |>
  gt::grand_summary_rows(
    columns = c(Age),
    fns = list(
      `Total M` = ~ mean(., na.rm = TRUE),
      `Total SD` = ~ sd(., na.rm = TRUE)
    ),
    fmt = list( ~ gt::fmt_number(., decimals = 2))
  ) |>
  gt::tab_options(table.font.names = "Times New Roman") |>

  gt::gtsave(filename = "Tables/Table S2_Speakers without PD Demographics.html")
```

# Table 1 - Speaker Demo
Summary of age, sex, PD severity count, years since diagnosis.
"For a full description..." supplemental info.
```{r}

demo_speaker_table <- speakers |>
  dplyr::mutate(
    Group = factor(Group, levels = c("Control", "PD"),
                   labels = c("Speakers without Parkinson's disease",
                              "Speakers with Parkinson's disease")),
    Severity = factor(
    Severity,
    levels = c("", "Mild", "Moderate", "Severe", "Profound"),
    labels = c(NA, "Mild", "Moderate", "Severe", "Profound")
  )) %>%
  base::rbind(., speakers |>
  dplyr::mutate(
    Group = "All Speakers",
    Severity = NA,
    dxTime = NA)) |>
  dplyr::mutate(Group = factor(
    Group,
    levels = c(
      "All Speakers",
      "Speakers without Parkinson's disease",
      "Speakers with Parkinson's disease"
    )
  )) |>
  select(-c(speaker_id, MoCA, Rating_M)) |> 
  gtsummary::tbl_summary(
        by = Group,
        type = list(
          Age ~ "continuous",
          Sex ~ "categorical",
          dxTime ~ "continuous",
          Severity ~ "categorical"
        ),
        statistic = list(
          Age ~ "{mean} ({sd})",
          dxTime ~ "{mean} ({sd})",
          all_categorical() ~ "{n} ({p}%)"
        ),
        digits = list(everything() ~ c(2), Sex ~ 0, Severity ~ 0),
        label = list(
          Age ~ "Age",
          Sex ~ "Sex",
          dxTime ~ "Time Since Diagnosis (years)",
          Severity ~ "Severity"
        ),
        missing = "no",
      ) %>%
      modify_header(all_stat_cols() ~ "**{level}**") |>
  gtsummary::modify_table_body(~ .x %>%
                                 mutate(
                                   across(all_stat_cols(), ~ gsub("^NA.*", "-", .)),
                                   across(all_stat_cols(), ~ gsub("^0.*", "-", .))
                                 )) |>
  modify_table_styling(
    columns = label,
    rows = label == "Severity",
    footnote = "Severity labels were previously determined in Thompson & Kim (2024) based on the intelligibility measures using the surrogate-severity measures outlined in Stipancic et al. (2022). Specifically, intelligibility values > 94% are 'Normal', 85% - 94% are 'Mild', 70% - 84% are 'Moderate', 45% - 69% are 'Severe', and < 45% are 'Profound'."
  )

demo_speaker_table

demo_speaker_table |>
  gtsummary::as_gt() |>
  gt::tab_options(table.font.names = "Times New Roman") |>
  gtsave("Tables/Table 1_speaker_demo.html")
```

# Table S3 - Listener Demographics
```{r}
# Loading in Perceptual Data
perceptual_data <- rio::import("Data/Cleaned Data/perceptual_ratings.csv") |>
  dplyr::mutate(counterbalance = as.factor(counterbalance),
                time_point = factor(time_point, levels = c("before", "sensors", "after")),
                reliability = factor(reliability, levels = c("initial", "reliability")),
                rating_type = factor(rating_type, levels = c("intelligibility", "naturalness")))

listener_demo <- rio::import("Data/Cleaned Data/listener_demographics.csv") |>
  dplyr::mutate(english = as.factor(english),
                age = as.numeric(age),
                gender = as.factor(gender),
                race = as.factor(race),
                ethnicity = as.factor(ethnicity))


# Listener Demographics Table
demo_listener_table <- listener_demo |>
  select(-c(listener_id, english)) |>
  gtsummary::tbl_summary(type = list(age ~ "continuous",
                          gender ~ "categorical",
                          race ~ "categorical",
                          ethnicity ~ "categorical"),
              statistic = list(all_continuous() ~ "{mean} ({sd})",
                               all_categorical() ~ "{n} ({p}%)"),
              digits = list(everything() ~ c(2),
                            gender ~ 0,
                            race ~ 0,
                            ethnicity ~ 0),
              label = list(age ~ "Age",
                           gender ~ "Gender",
                           race ~ "Race",
                           ethnicity ~ "Ethnicity")) |>
  gtsummary::as_gt() |>
  gt::tab_options(table.font.names = "Times New Roman")

demo_listener_table

demo_listener_table |>
  gtsave("Tables/Table S3_listener_demo.html")

rm(demo_listener_table, listener_demo)
```


# Table S4 - Passage Sections

# Table S5 - Summary Measures
```{r}
workingData_articRate <- base::readRDS(file = "Data/workingData/data_articRate.RDS")
workingData_VSA <- base::readRDS(file = "Data/workingData/data_VSA.RDS")
workingData_M1s <- base::readRDS(file = "Data/workingData/data_M1s.RDS")
workingData_M1sh <- base::readRDS(file = "Data/workingData/data_M1sh.RDS")
workingData_M2s <- base::readRDS(file = "Data/workingData/data_M2s.RDS")
workingData_M2sh <- base::readRDS(file = "Data/workingData/data_M2sh.RDS")
workingData_Int <- base::readRDS(file = "Data/workingData/data_Int.RDS")
workingData_Nat <- base::readRDS(file = "Data/workingData/data_Nat.RDS")

allData <- rbind(
  workingData_articRate$modelData %>%
    dplyr::mutate(measure = "Articulation Rate") %>%
    dplyr::rename(value = artic_rate_m),
  
  workingData_VSA$modelData %>%
    dplyr::select(!seg_type) %>%
    dplyr::mutate(measure = "VSA") %>%
    dplyr::rename(value = VSA),
  
  workingData_M1s$modelData %>%
    dplyr::select(!c(seg_type, M2, consonant)) %>%
    dplyr::mutate(measure = "M1 for /s/") %>%
    dplyr::rename(value = M1),
  
  workingData_M2s$modelData %>%
    dplyr::select(!c(seg_type, consonant)) %>%
    dplyr::mutate(measure = "M2 for /s/") %>%
    dplyr::rename(value = M2),
  
  workingData_M1sh$modelData %>%
    dplyr::select(!c(seg_type, M2, consonant)) %>%
    dplyr::mutate(measure = "M1 for /ʃ/") %>%
    dplyr::rename(value = M1),
  
  workingData_M2sh$modelData %>%
    dplyr::select(!c(seg_type, consonant)) %>%
    dplyr::mutate(measure = "M2 for /ʃ/") %>%
    dplyr::rename(value = M2),
  
  workingData_Int$modelData %>%
    dplyr::select(!Int_sd) %>%
    dplyr::mutate(measure = "Intelligibility") %>%
    dplyr::rename(value = Int),
  
  workingData_Nat$modelData %>%
    dplyr::select(!Nat_sd) %>%
    dplyr::mutate(measure = "Naturalness") %>%
    dplyr::rename(value = Nat)
) %>%
  dplyr::mutate(time_point = factor(time_point,
                                    levels = c("before",
                                               "sensors",
                                               "after"),
                                    labels = c("Before Sensors",
                                               "With Sensors",
                                               "After Sensors")))

tableData <- rbind(
  allData %>%
    dplyr::mutate(row_group = "All Speakers"),
  
  allData %>%
    dplyr::filter(sex == "Male") %>%
    dplyr::mutate(row_group = "Male Speakers"),
  
  allData %>%
    dplyr::filter(sex == "Female") %>%
    dplyr::mutate(row_group = "Female Speakers")
) %>%
  dplyr::group_by(group, measure, row_group, time_point) %>%
  dplyr::summarise(M = mean(value), SD = sd(value),
                   M_sd = paste0(weights::rd(M)," (",weights::rd(SD),")")) %>%
  dplyr::ungroup() %>%
  dplyr::select(!c(M,SD)) %>%
  tidyr::pivot_wider(names_from = time_point, values_from = M_sd) %>%
  tidyr::pivot_wider(names_from = group, values_from = `Before Sensors`:`After Sensors`) %>%
  dplyr::mutate(measure = factor(measure,
                                 levels = c("Articulation Rate",
                                            "VSA",
                                            "M1 for /s/",
                                            "M2 for /s/",
                                            "M1 for /ʃ/",
                                            "M2 for /ʃ/",
                                            "Intelligibility",
                                            "Naturalness"),
                                 labels = c("Articulation Rate (syl/s)",
                                            "Acoustic Vowel Space Area (kHz2)",
                                            "M1 for /s/",
                                            "M2 for /s/",
                                            "M1 for /ʃ/",
                                            "M2 for /ʃ/",
                                            "Intelligibility (VAS)",
                                            "Naturalness (VAS)"))) %>%
  arrange(measure) %>%
  arrange(row_group)



tableData %>%
  dplyr::relocate(contains("PD"), .after = "After Sensors_Control") |>
  group_by(row_group) |>
  gt::gt() |>
    tab_spanner(
    label = "Speakers without Parkinson's Disease",
    columns = contains("Control"),
    level = 2,
    gather = F
  ) |>
  tab_spanner(
    label = "Speakers with Parkinson's Disease",
    columns = contains("PD"),
    level = 2,
    gather = F
  ) |>
  gt::cols_label(
    contains("Before") ~ "Before Sensors",
    contains("With") ~ "With Sensors",
    contains("After") ~ "After Sensors",
    "measure" = "Measure"
  ) |>
  gt::tab_options(table.font.names = "Times New Roman") |>
  gt::gtsave(filename = "Tables/Table S5_Summary Statistics.html")


```



# Table 2 - ArticRate & VSA
```{r}
workingData_articRate <- base::readRDS(file = "Data/workingData/data_articRate.RDS")
workingData_VSA <- base::readRDS(file = "Data/workingData/data_VSA.RDS")

sjPlot::tab_model(
  workingData_articRate$model,
  workingData_VSA$model,
  pred.labels = c(
    "Intercept",
    "Time Point [Sensors]",
    "Time Point [After]",
    "Group [PD]",
    "Sex [Female]",
    "Age",
    "Time Point [Sensors] * Group [PD]",
    "Time Point [After] * Group [PD]"
  ),
  emph.p = FALSE,
  p.style = "numeric_stars",
  p.threshold = c(alpha_level),
  order.terms = c(1, 4, 5, 6, 2, 7, 3, 8),
  dv.labels = c("Articulation Rate","Acoustic Vowel Space Area"),
  file = "Tables/Table 2_articRate and VSA.html"
)
```


# Table 3 - M1
```{r}
workingData_M1s <- base::readRDS(file = "Data/workingData/data_M1s.RDS")
workingData_M1sh <- base::readRDS(file = "Data/workingData/data_M1sh.RDS")

sjPlot::tab_model(
  workingData_M1s$model,
  workingData_M1sh$model,
  pred.labels = c(
    "Intercept",
    "Time Point [Sensors]",
    "Time Point [After]",
    "Group [PD]",
    "Sex [Female]",
    "Age",
    "Time Point [Sensors] * Group [PD]",
    "Time Point [After] * Group [PD]"
  ),
  emph.p = FALSE,
  p.style = "numeric_stars",
  p.threshold = c(alpha_level),
  order.terms = c(1, 4, 5, 6, 2, 7, 3, 8),
  dv.labels = c("M1 for /s/","M1 for /ʃ/")
)

CI_s <- parameters::ci(workingData_M1s$model) %>%
  as.data.frame() %>%
  dplyr::rename(term = Parameter) %>%
  dplyr::mutate(
    CI_s = paste0(
      weights::rd(CI_low, add = F), " - ",
      weights::rd(CI_high, add = F)
    )
    )
CI_sh <- parameters::ci(workingData_M1sh$model) %>%
  as.data.frame() %>%
  dplyr::rename(term = Parameter) %>%
  dplyr::mutate(
    CI_sh = paste0(
      weights::rd(CI_low, add = F), " - ",
      weights::rd(CI_high, add = F)
    )
    )

# M1 - s ----
M1s_table <- broom.mixed::tidy(workingData_M1s$model, "fixed") %>%
  base::merge(., CI_s, by.x = "term") %>%
  dplyr::rename(estimate_s = estimate) %>%
  dplyr::mutate(
    estimate_s = weights::rd(estimate_s) %>%
                  as.character()) %>%
  add_row(
    effect = "random",
    term = "σ^2",
    estimate_s = insight::get_variance(workingData_M1s$model)$var.residual %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "τ00 speaker_id",
    estimate_s = insight::get_variance(workingData_M1s$model)$var.intercept %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "ICC",
    estimate_s = performance::icc(workingData_M1s$model)$ICC_adjusted %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "N speaker_id",
    estimate_s = summary(workingData_M1s$model)[["ngrps"]][["speaker_id"]] %>%
      weights::rd(digits=0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Observations",
    estimate_s = NROW(summary(workingData_M1s$model)[["residuals"]]) %>%
      weights::rd(digits = 0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Marginal R2 / Conditional R2",
    estimate_s = paste0(
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M1s$model) %>%
          as.data.frame() %>%
          pull(R2m),
      ),
      " / ",
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M1s$model) %>%
          as.data.frame() %>%
          pull(R2c)
      )
    )
  ) %>%
  dplyr::mutate(
    p_s = case_when(
      p.value < .001 ~ "<.001",
      p.value > .001 ~ as.character(sub("^(-?)0.", "\\1.", sprintf("%.3f", p.value))),
      TRUE ~ as.character(p.value)
    ),
    sig_s = ifelse(p.value < alpha_level,"sig","ns"),
    effect = factor(effect,
                    levels = c("fixed",
                               "random",
                               "summary"),
                    labels = c("Fixed Effects",
                               "Random Effects",
                               "Summary")),
    term = factor(term,
                  levels = c("(Intercept)",
                             "groupPD",
                             "sexFemale",
                             "age",
                             "time_pointsensors",
                             "time_pointsensors:groupPD",
                             "time_pointafter",
                             "time_pointafter:groupPD",
                             "σ^2",
                             "τ00 speaker_id",
                             "ICC",
                             "N speaker_id",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ),
                  labels = c("(Intercept)",
                             "Group [PD]",
                             "Sex [Female]",
                             "Age",
                             "Time Point [With Sensors]",
                             "Time Point [With Sensors] × Group [PD]",
                             "Time Point [After Sensors]",
                             "Time Point [After Sensors] × Group [PD]",
                             "σ^2",
                             "τ00 SpeakerID",
                             "ICC",
                             "N SpeakerID",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ))
    ) %>%
  arrange(term)

# M1 - sh ----
M1sh_table <- broom.mixed::tidy(workingData_M1sh$model, "fixed") %>%
  base::merge(., CI_sh, by.x = "term") %>%
  dplyr::rename(estimate_sh = estimate) %>%
  dplyr::mutate(
    estimate_sh = weights::rd(estimate_sh) %>%
                  as.character()) %>%
  add_row(
    effect = "random",
    term = "σ^2",
    estimate_sh = insight::get_variance(workingData_M1sh$model)$var.residual %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "τ00 speaker_id",
    estimate_sh = insight::get_variance(workingData_M1sh$model)$var.intercept %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "ICC",
    estimate_sh = performance::icc(workingData_M1sh$model)$ICC_adjusted %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "N speaker_id",
    estimate_sh = summary(workingData_M1sh$model)[["ngrps"]][["speaker_id"]] %>%
      weights::rd(digits=0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Observations",
    estimate_sh = NROW(summary(workingData_M1sh$model)[["residuals"]]) %>%
      weights::rd(digits = 0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Marginal R2 / Conditional R2",
    estimate_sh = paste0(
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M1sh$model) %>%
          as.data.frame() %>%
          pull(R2m),
      ),
      " / ",
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M1sh$model) %>%
          as.data.frame() %>%
          pull(R2c)
      )
    )
  ) %>%
  dplyr::mutate(
    p_sh = case_when(
      p.value < .001 ~ "<.001",
      p.value > .001 ~ as.character(sub("^(-?)0.", "\\1.", sprintf("%.3f", p.value))),
      TRUE ~ as.character(p.value)
    ),
    sig_sh = ifelse(p.value < alpha_level,"sig","ns"),
    effect = factor(effect,
                    levels = c("fixed",
                               "random",
                               "summary"),
                    labels = c("Fixed Effects",
                               "Random Effects",
                               "Summary")),
    term = factor(term,
                  levels = c("(Intercept)",
                             "groupPD",
                             "sexFemale",
                             "age",
                             "time_pointsensors",
                             "time_pointsensors:groupPD",
                             "time_pointafter",
                             "time_pointafter:groupPD",
                             "σ^2",
                             "τ00 speaker_id",
                             "ICC",
                             "N speaker_id",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ),
                  labels = c("(Intercept)",
                             "Group [PD]",
                             "Sex [Female]",
                             "Age",
                             "Time Point [With Sensors]",
                             "Time Point [With Sensors] × Group [PD]",
                             "Time Point [After Sensors]",
                             "Time Point [After Sensors] × Group [PD]",
                             "σ^2",
                             "τ00 SpeakerID",
                             "ICC",
                             "N SpeakerID",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ))
    ) %>%
  arrange(term)

# M1 Table ----
M1_tableData <- base::merge(
  M1s_table %>%
    dplyr::select(term, effect, estimate_s,CI_s, p_s, sig_s),
  M1sh_table %>%
    dplyr::select(term, effect, estimate_sh,CI_sh, p_sh, sig_sh)
) %>%
  arrange(term)

M1_tableData %>%
  group_by(effect) %>%
  gt::gt() |>
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = c(estimate_s:p_s), rows = sig_s == "sig")
  ) |>
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = c(estimate_sh:p_sh), rows = sig_sh == "sig")
  ) |>
  gt::cols_align(columns = term, align = "left") |>
  gt::cols_align(columns = estimate_s:p_sh, align = "right") |>
  gt::sub_missing(columns = everything(),
                  rows = everything(),
                  missing_text = "") |>
  gt::tab_spanner(columns = estimate_s:p_s,
                  label = "M1 for /s/") |>
  gt::tab_spanner(columns = estimate_sh:p_sh,
                  label = "M1 for /ʃ/") |>
  gt::cols_label("term" = "Predictors",
                 "estimate_s" = "Estimates",
                 "CI_s" = "CI",
                 "p_s" = "p",
                 "estimate_sh" = "Estimates",
                 "CI_sh" = "CI",
                 "p_sh" = "p") |>
  gt::cols_hide(c(sig_s, sig_sh)) |>
  tab_options(row_group.as_column = TRUE) |>
  gt::gtsave(filename = "Tables/Table 3_M1.html")
  
```

# Table 4 - M2
```{r}
workingData_M2s <- base::readRDS(file = "Data/workingData/data_M2s.RDS")
workingData_M2sh <- base::readRDS(file = "Data/workingData/data_M2sh.RDS")

sjPlot::tab_model(
  workingData_M2s$model,
  workingData_M2sh$model,
  pred.labels = c(
    "Intercept",
    "Time Point [Sensors]",
    "Time Point [After]",
    "Group [PD]",
    "Sex [Female]",
    "Age",
    "Time Point [Sensors] * Group [PD]",
    "Time Point [After] * Group [PD]"
  ),
  emph.p = FALSE,
  p.style = "numeric_stars",
  p.threshold = c(alpha_level),
  order.terms = c(1, 4, 5, 6, 2, 7, 3, 8),
  dv.labels = c("M2 for /s/","M2 for /ʃ/")
)

CI_s <- parameters::ci(workingData_M2s$model) %>%
  as.data.frame() %>%
  dplyr::rename(term = Parameter) %>%
  dplyr::mutate(
    CI_s = paste0(
      weights::rd(CI_low, add = F), " - ",
      weights::rd(CI_high, add = F)
    )
    )
CI_sh <- parameters::ci(workingData_M2sh$model) %>%
  as.data.frame() %>%
  dplyr::rename(term = Parameter) %>%
  dplyr::mutate(
    CI_sh = paste0(
      weights::rd(CI_low, add = F), " - ",
      weights::rd(CI_high, add = F)
    )
    )

# M2 - s ----
M2s_table <- broom.mixed::tidy(workingData_M2s$model, "fixed") %>%
  base::merge(., CI_s, by.x = "term") %>%
  dplyr::rename(estimate_s = estimate) %>%
  dplyr::mutate(
    estimate_s = weights::rd(estimate_s) %>%
                  as.character()) %>%
  add_row(
    effect = "random",
    term = "σ^2",
    estimate_s = insight::get_variance(workingData_M2s$model)$var.residual %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "τ00 speaker_id",
    estimate_s = insight::get_variance(workingData_M2s$model)$var.intercept %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "ICC",
    estimate_s = performance::icc(workingData_M2s$model)$ICC_adjusted %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "N speaker_id",
    estimate_s = summary(workingData_M2s$model)[["ngrps"]][["speaker_id"]] %>%
      weights::rd(digits=0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Observations",
    estimate_s = NROW(summary(workingData_M2s$model)[["residuals"]]) %>%
      weights::rd(digits = 0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Marginal R2 / Conditional R2",
    estimate_s = paste0(
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M2s$model) %>%
          as.data.frame() %>%
          pull(R2m),
      ),
      " / ",
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M2s$model) %>%
          as.data.frame() %>%
          pull(R2c)
      )
    )
  ) %>%
  dplyr::mutate(
    p_s = case_when(
      p.value < .001 ~ "<.001",
      p.value > .001 ~ as.character(sub("^(-?)0.", "\\1.", sprintf("%.3f", p.value))),
      TRUE ~ as.character(p.value)
    ),
    sig_s = ifelse(p.value < alpha_level,"sig","ns"),
    effect = factor(effect,
                    levels = c("fixed",
                               "random",
                               "summary"),
                    labels = c("Fixed Effects",
                               "Random Effects",
                               "Summary")),
    term = factor(term,
                  levels = c("(Intercept)",
                             "groupPD",
                             "sexFemale",
                             "age",
                             "time_pointsensors",
                             "time_pointsensors:groupPD",
                             "time_pointafter",
                             "time_pointafter:groupPD",
                             "σ^2",
                             "τ00 speaker_id",
                             "ICC",
                             "N speaker_id",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ),
                  labels = c("(Intercept)",
                             "Group [PD]",
                             "Sex [Female]",
                             "Age",
                             "Time Point [With Sensors]",
                             "Time Point [With Sensors] × Group [PD]",
                             "Time Point [After Sensors]",
                             "Time Point [After Sensors] × Group [PD]",
                             "σ^2",
                             "τ00 SpeakerID",
                             "ICC",
                             "N SpeakerID",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ))
    ) %>%
  arrange(term)

# M2 - sh ----
M2sh_table <- broom.mixed::tidy(workingData_M2sh$model, "fixed") %>%
  base::merge(., CI_sh, by.x = "term") %>%
  dplyr::rename(estimate_sh = estimate) %>%
  dplyr::mutate(
    estimate_sh = weights::rd(estimate_sh) %>%
                  as.character()) %>%
  add_row(
    effect = "random",
    term = "σ^2",
    estimate_sh = insight::get_variance(workingData_M2sh$model)$var.residual %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "τ00 speaker_id",
    estimate_sh = insight::get_variance(workingData_M2sh$model)$var.intercept %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "ICC",
    estimate_sh = performance::icc(workingData_M2sh$model)$ICC_adjusted %>%
      weights::rd() %>%
      as.character()
  ) %>%
  add_row(
    effect = "random",
    term = "N speaker_id",
    estimate_sh = summary(workingData_M2sh$model)[["ngrps"]][["speaker_id"]] %>%
      weights::rd(digits=0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Observations",
    estimate_sh = NROW(summary(workingData_M2sh$model)[["residuals"]]) %>%
      weights::rd(digits = 0) %>%
      as.character()
  ) %>%
  add_row(
    effect = "summary",
    term = "Marginal R2 / Conditional R2",
    estimate_sh = paste0(
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M2sh$model) %>%
          as.data.frame() %>%
          pull(R2m),
      ),
      " / ",
      weights::rd(
        MuMIn::r.squaredGLMM(workingData_M2sh$model) %>%
          as.data.frame() %>%
          pull(R2c)
      )
    )
  ) %>%
  dplyr::mutate(
    p_sh = case_when(
      p.value < .001 ~ "<.001",
      p.value > .001 ~ as.character(sub("^(-?)0.", "\\1.", sprintf("%.3f", p.value))),
      TRUE ~ as.character(p.value)
    ),
    sig_sh = ifelse(p.value < alpha_level,"sig","ns"),
    effect = factor(effect,
                    levels = c("fixed",
                               "random",
                               "summary"),
                    labels = c("Fixed Effects",
                               "Random Effects",
                               "Summary")),
    term = factor(term,
                  levels = c("(Intercept)",
                             "groupPD",
                             "sexFemale",
                             "age",
                             "time_pointsensors",
                             "time_pointsensors:groupPD",
                             "time_pointafter",
                             "time_pointafter:groupPD",
                             "σ^2",
                             "τ00 speaker_id",
                             "ICC",
                             "N speaker_id",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ),
                  labels = c("(Intercept)",
                             "Group [PD]",
                             "Sex [Female]",
                             "Age",
                             "Time Point [With Sensors]",
                             "Time Point [With Sensors] × Group [PD]",
                             "Time Point [After Sensors]",
                             "Time Point [After Sensors] × Group [PD]",
                             "σ^2",
                             "τ00 SpeakerID",
                             "ICC",
                             "N SpeakerID",
                             "Observations",
                             "Marginal R2 / Conditional R2"
                             ))
    ) %>%
  arrange(term)

# M2 Table ----
M2_tableData <- base::merge(
  M2s_table %>%
    dplyr::select(term, effect, estimate_s,CI_s, p_s, sig_s),
  M2sh_table %>%
    dplyr::select(term, effect, estimate_sh,CI_sh, p_sh, sig_sh)
) %>%
  arrange(term)

M2_tableData %>%
  group_by(effect) %>%
  gt::gt() |>
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = c(estimate_s:p_s), rows = sig_s == "sig")
  ) |>
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = c(estimate_sh:p_sh), rows = sig_sh == "sig")
  ) |>
  gt::cols_align(columns = term, align = "left") |>
  gt::cols_align(columns = estimate_s:p_sh, align = "right") |>
  gt::sub_missing(columns = everything(),
                  rows = everything(),
                  missing_text = "") |>
  gt::tab_spanner(columns = estimate_s:p_s,
                  label = "M2 for /s/") |>
  gt::tab_spanner(columns = estimate_sh:p_sh,
                  label = "M2 for /ʃ/") |>
  gt::cols_label("term" = "Predictors",
                 "estimate_s" = "Estimates",
                 "CI_s" = "CI",
                 "p_s" = "p",
                 "estimate_sh" = "Estimates",
                 "CI_sh" = "CI",
                 "p_sh" = "p") |>
  gt::cols_hide(c(sig_s, sig_sh)) |>
  tab_options(row_group.as_column = TRUE) |>
  gt::gtsave(filename = "Tables/Table 4_M2.html")
  

```

# Table 5 - Perceptual Measures
```{r}
workingData_Int <- base::readRDS(file = "Data/workingData/data_Int.RDS")
workingData_Nat <- base::readRDS(file = "Data/workingData/data_Nat.RDS")

sjPlot::tab_model(
  workingData_Int$model,
  workingData_Nat$model,
  pred.labels = c(
    "Intercept",
    "Time Point [Sensors]",
    "Time Point [After]",
    "Group [PD]",
    "Sex [Female]",
    "Age",
    "Time Point [Sensors] * Group [PD]",
    "Time Point [After] * Group [PD]"
  ),
  emph.p = FALSE,
  p.style = "numeric_stars",
  p.threshold = c(alpha_level),
  order.terms = c(1, 4, 5, 6, 2, 7, 3, 8),
  dv.labels = c("Intelligibility","Naturalness"),
  file = "Tables/Table 5_Perceptual Measures.html"
)

```

# Table S6 - Pairwise Comparisons
```{r}
workingData_articRate <- base::readRDS(file = "Data/workingData/data_articRate.RDS")
workingData_VSA <- base::readRDS(file = "Data/workingData/data_VSA.RDS")
workingData_M1s <- base::readRDS(file = "Data/workingData/data_M1s.RDS")
workingData_M1sh <- base::readRDS(file = "Data/workingData/data_M1sh.RDS")
workingData_M2s <- base::readRDS(file = "Data/workingData/data_M2s.RDS")
workingData_M2sh <- base::readRDS(file = "Data/workingData/data_M2sh.RDS")
workingData_Int <- base::readRDS(file = "Data/workingData/data_Int.RDS")
workingData_Nat <- base::readRDS(file = "Data/workingData/data_Nat.RDS")

# articRate ----
inText_articRate <- base::merge(
  workingData_articRate[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_articRate[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "articRate",
    comparison = case_when(t.ratio > 0 &
                             sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(pattern = "-",replacement = ">",x = contrast),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# VSA ----
inText_VSA <- base::merge(
  workingData_VSA[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_VSA[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "VSA",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# M1s ----
inText_M1s <- base::merge(
  workingData_M1s[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M1s[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M1s",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# M1sh ----
inText_M1sh <- base::merge(
  workingData_M1sh[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M1sh[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M1sh",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# M2s ----
inText_M2s <- base::merge(
  workingData_M2s[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M2s[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M2s",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# M2sh ----
inText_M2sh <- base::merge(
  workingData_M2sh[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M2sh[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M2sh",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# Int ----
inText_Int <- base::merge(
  workingData_Int[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_Int[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "Int",
    comparison = case_when(z.ratio > 0 & sig == "*" ~ ">", z.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

# Nat ----
inText_Nat <- base::merge(
  workingData_Nat[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_Nat[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "Nat",
    comparison = case_when(z.ratio > 0 & sig == "*" ~ ">", z.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    interpretation = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    )
  )

pairwiseContrasts <- rbind(
  inText_articRate,
  inText_VSA,
  inText_M1s,
  inText_M1sh,
  inText_M2s,
  inText_M2sh,
  inText_Int %>%
    dplyr::rename(t.ratio = z.ratio,
                  lower_cl = asymp_lcl,
                  upper_cl = asymp_ucl),
  inText_Nat %>%
    dplyr::rename(t.ratio = z.ratio,
                  lower_cl = asymp_lcl,
                  upper_cl = asymp_ucl)
) %>%
  dplyr::mutate(
    RQ = case_when(
      grepl(pattern = "Sensors", contrast) ~ "RQ1, Before Sensors - With Sensors",
      grepl(pattern = "After", contrast) ~ "RQ2, Before Sensors - After Sensors"
    ),
      measure = factor(measure,
                                 levels = c("articRate",
                                            "VSA",
                                            "M1s",
                                            "M2s",
                                            "M1sh",
                                            "M2sh",
                                            "Int",
                                            "Nat"),
                                 labels = c("Articulation Rate (syl/s)",
                                            "Acoustic Vowel Space Area (log)",
                                            "M1 for /s/",
                                            "M2 for /s/",
                                            "M1 for /ʃ/",
                                            "M2 for /ʃ/",
                                            "Intelligibility (VAS)",
                                            "Naturalness (VAS)"))
  ) %>%
  dplyr::relocate(RQ, .before = contrast) |>
  dplyr::relocate(measure, .after = RQ) %>%
  arrange(measure) %>%
  arrange(contrast)

pairwiseContrasts %>%
  dplyr::select(RQ, measure, group, estimate, t.ratio, p.value, effect_size, sig) %>%
  dplyr::mutate(estimate = weights::rd(estimate),
                t.ratio = weights::rd(t.ratio),
                p.value = ifelse(p.value < .001,"<.001", weights::rd(p.value, digits = 3)),
                effect_size = weights::rd(effect_size)) %>%
  tidyr::pivot_wider(names_from = group,
                     values_from = estimate:sig) %>%
  group_by(RQ) %>%
  gt::gt() |>
  
  # Add bolding for significant contrasts
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = gt::contains("_Control"), rows = sig_Control == "*")
  ) |>
  gt::tab_style(
    style = list(gt::cell_text(weight = "bold")),
    locations = gt::cells_body(columns = gt::contains("_PD"), rows = sig_PD == "*")
  ) |>
  
  gt::tab_spanner(label = "Speakers with Parkinson's disease",
                  columns = gt::contains("_PD")) |>
  gt::tab_spanner(label = "Speakers without Parkinson's disease",
                  columns = gt::contains("_Control")) |>
  gt::cols_label(
    "measure" = "Measure",
    contains("estimate") ~ "Estimate",
    contains("t.ratio") ~ "t/z",
    contains("p.value") ~ "p",
    contains("effect_size") ~ "d"
  ) |>
  gt::cols_hide(contains("sig")) |>
  
  gt::cols_align(
    align = "right",
    columns = c(gt::contains("p.value"))
  ) |>
  
  gt::cols_align(
    align = "left",
    columns = "measure"
  ) |>
  
  # Adding footnote to Severity
  gt::tab_footnote(
    footnote = "The test statistic for Intelligibility and Naturalness, which used robust linear mixed effect models, was z. For all other measures, the test statistic was t.",
    locations = gt::cells_column_labels(columns = contains("t.ratio"))
  ) |>
  gt::tab_footnote(
    footnote = "Positive estimates indicate Before Sensors > With Sensors or Before Sensors > After Sensors; Negative estimates indicate Before Sensors < With Sensors or Before Sensors < After Sensors.",
    locations = gt::cells_column_labels(columns = contains("estimate"))
  ) |>
  gt::tab_options(table.font.names = "Times New Roman") |>
  
  gt::gtsave(filename = "Tables/Table S6_Pairwise Comparisons.html")
  
  


```


# In Text Pairwise Contrast Stats
```{r}
workingData_articRate <- base::readRDS(file = "Data/workingData/data_articRate.RDS")
workingData_VSA <- base::readRDS(file = "Data/workingData/data_VSA.RDS")
workingData_M1s <- base::readRDS(file = "Data/workingData/data_M1s.RDS")
workingData_M1sh <- base::readRDS(file = "Data/workingData/data_M1sh.RDS")
workingData_M2s <- base::readRDS(file = "Data/workingData/data_M2s.RDS")
workingData_M2sh <- base::readRDS(file = "Data/workingData/data_M2sh.RDS")
workingData_Int <- base::readRDS(file = "Data/workingData/data_Int.RDS")
workingData_Nat <- base::readRDS(file = "Data/workingData/data_Nat.RDS")

# articRate ----
inText_articRate <- base::merge(
  workingData_articRate[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_articRate[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "articRate",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# VSA ----
inText_VSA <- base::merge(
  workingData_VSA[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_VSA[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "VSA",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# M1s ----
inText_M1s <- base::merge(
  workingData_M1s[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M1s[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M1s",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# M1sh ----
inText_M1sh <- base::merge(
  workingData_M1sh[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M1sh[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M1sh",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# M2s ----
inText_M2s <- base::merge(
  workingData_M2s[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M2s[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M2s",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# M2sh ----
inText_M2sh <- base::merge(
  workingData_M2sh[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_M2sh[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "M2sh",
    comparison = case_when(t.ratio > 0 & sig == "*" ~ ">", t.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "t(",
      weights::rd(df, digits = 0),
      ") = ",
      weights::rd(t.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# Int ----
inText_Int <- base::merge(
  workingData_Int[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_Int[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "Int",
    comparison = case_when(z.ratio > 0 & sig == "*" ~ ">", z.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "z = ",
      weights::rd(z.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

# Nat ----
inText_Nat <- base::merge(
  workingData_Nat[["sigContrasts"]] %>%
    dplyr::mutate(contrast = factor(
      contrast,
      levels = c("before - sensors", "before - after"),
      labels = c("Before - Sensors", "Before - After")
    )) %>%
    dplyr::select(!condition),
  workingData_Nat[["pairwiseES"]] %>%
    dplyr::select(!df),
  by = c("contrast", "group"),
  all = F
) %>%
  dplyr::mutate(
    measure = "Nat",
    comparison = case_when(z.ratio > 0 & sig == "*" ~ ">", z.ratio < 0 &
                             sig == "*" ~ "<", TRUE ~ "="),
    contrast = case_when(
      comparison == ">" ~ gsub(
        pattern = "-",
        replacement = ">",
        x = contrast
      ),
      comparison == "<" ~ gsub(
        pattern = "-",
        replacement = "<",
        x = contrast
      ),
      TRUE ~ contrast
    ),
    writeUp = paste0(
      group,
      ", ",
      contrast,
      ": ",
      "z = ",
      weights::rd(z.ratio),
      ", ",
      ifelse(p.value < .001, "p < .001", paste0("p = ", weights::rd(p.value, digits = 3))),
      ", d = ",
      weights::rd(effect_size)
    )
  )

inText_writeUp <- rbind(
  inText_articRate,
  inText_VSA,
  inText_M1s,
  inText_M1sh,
  inText_M2s,
  inText_M2sh,
  inText_Int %>%
    dplyr::rename(t.ratio = z.ratio,
                  lower_cl = asymp_lcl,
                  upper_cl = asymp_ucl),
  inText_Nat %>%
    dplyr::rename(t.ratio = z.ratio,
                  lower_cl = asymp_lcl,
                  upper_cl = asymp_ucl)
) %>%
  dplyr::mutate(
    RQ = case_when(
      grepl(pattern = "Sensors", contrast) ~ "RQ1",
      grepl(pattern = "After", contrast) ~ "RQ2"
    )
  ) %>%
  dplyr::relocate(RQ, .before = contrast) |>
  dplyr::relocate(measure, .after = RQ) |>
  dplyr::relocate(writeUp, .after = group)


```


